<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <title>Label Scanner</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1>ğŸ“· Label Scanner</h1>
            <p>Scan product labels instantly</p>
        </header>

        <!-- OCR Mode Toggle -->
        <div class="mode-section">
            <div class="mode-toggle">
                <button id="mode-online" class="mode-btn active">âš¡ Online (Best)</button>
                <button id="mode-offline" class="mode-btn">ğŸ“´ Offline</button>
            </div>
            <div id="mode-status" class="mode-status">Using advanced dual-engine OCR</div>
        </div>

        <!-- Quick Mode Toggle -->
        <div class="controls">
            <label class="quick-mode">
                <input type="checkbox" id="quick-mode">
                <span>ğŸš€ Quick Mode</span>
                <small>(ON = skip cropping, faster but less accurate)</small>
            </label>
        </div>

        <!-- Upload Buttons -->
        <div class="upload-section">
            <div class="upload-buttons">
                <label for="camera-input" class="upload-btn camera">ğŸ“· Camera</label>
                <input type="file" id="camera-input" accept="image/*" capture="environment">

                <label for="gallery-input" class="upload-btn gallery">ğŸ–¼ï¸ Gallery</label>
                <input type="file" id="gallery-input" accept="image/*">
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p id="loading-text">Processing...</p>
        </div>

        <!-- Results -->
        <div id="results" class="results hidden">
            <h2>ğŸ“‹ Results</h2>

            <!-- Photo Preview -->
            <img id="preview" class="preview" src="" alt="Preview">

            <!-- Data Fields (Editable) -->
            <div class="field">
                <label>ğŸ”¢ Batch No</label>
                <input type="text" id="batch" placeholder="Not found">
                <span id="conf-batch" class="badge"></span>
            </div>
            <div class="field">
                <label>ğŸ“… Mfg Date</label>
                <input type="text" id="mfg" placeholder="Not found">
                <span id="conf-mfg" class="badge"></span>
            </div>
            <div class="field">
                <label>â° Expiry Date</label>
                <input type="text" id="expiry" placeholder="Not found">
                <span id="conf-expiry" class="badge"></span>
            </div>
            <div class="field">
                <label>ğŸ¹ Flavour</label>
                <input type="text" id="flavour" placeholder="Not found">
            </div>
            <div class="field location-field">
                <label>ğŸ“ Godown</label>
                <input type="text" id="godown" list="godown-list" placeholder="Type or select...">
                <datalist id="godown-list">
                    <option value="Godown A">
                    <option value="Godown B">
                    <option value="Godown C">
                    <option value="Warehouse 1">
                    <option value="Warehouse 2">
                    <option value="Cold Storage">
                </datalist>
            </div>

            <!-- Actions -->
            <div class="actions">
                <button id="save-btn" class="btn save">ğŸ’¾ Save</button>
                <button id="sheets-btn" class="btn sheets">ğŸ“Š Send to Sheets</button>
            </div>
            <div class="actions">
                <button id="clear-btn" class="btn clear">ğŸ”„ New Scan</button>
            </div>

            <!-- Continuous Mode -->
            <label class="continuous">
                <input type="checkbox" id="continuous">
                <span>âš¡ Auto-save & next</span>
            </label>

            <!-- Raw OCR -->
            <details class="raw-section">
                <summary>ğŸ“ Raw OCR Text</summary>
                <pre id="raw-text"></pre>
            </details>
        </div>

        <!-- History -->
        <div class="history-section">
            <div class="history-header">
                <h2>ğŸ“š History</h2>
                <div class="export-buttons">
                    <button id="export-btn" class="btn export">ğŸ“¥ CSV</button>
                    <button id="export-nav-btn" class="btn nav">ğŸ“¤ NAV</button>
                </div>
            </div>
            <input type="text" id="search" class="search" placeholder="ğŸ” Search...">
            <div id="history-list" class="history-list">
                <p class="empty">No scans yet</p>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="toast hidden"></div>
    </div>

    <!-- Crop Modal -->
    <div id="crop-modal" class="modal hidden">
        <div class="modal-content">
            <h3>âœ‚ï¸ Crop Label</h3>
            <p>Drag box to select label area</p>
            <div id="crop-container" class="crop-container">
                <img id="crop-image" src="" alt="Crop">
                <div id="crop-box" class="crop-box">
                    <div class="resize-handle nw" data-dir="nw"></div>
                    <div class="resize-handle ne" data-dir="ne"></div>
                    <div class="resize-handle sw" data-dir="sw"></div>
                    <div class="resize-handle se" data-dir="se"></div>
                    <div class="resize-handle n" data-dir="n"></div>
                    <div class="resize-handle s" data-dir="s"></div>
                    <div class="resize-handle e" data-dir="e"></div>
                    <div class="resize-handle w" data-dir="w"></div>
                </div>
            </div>
            <div class="modal-actions">
                <button id="crop-skip" class="btn">âŒ Skip</button>
                <button id="crop-confirm" class="btn save">âœ… Crop</button>
            </div>
        </div>
    </div>

    <!-- Tesseract.js for offline OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <!-- Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/parser.js"></script>
    <script src="js/ocr.js"></script>
    <script src="js/offline-ocr.js"></script>
    <script src="js/app.js"></script>
</body>

</html>